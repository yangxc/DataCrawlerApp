<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout">
    <head>
	    <meta charset="utf-8" />
	    <title>首页</title>
	    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
	    <meta name="viewport" content="width=device-width, initial-scale=1" />
	    <script th:src="@{/js/jquery.js}" type="text/javascript"></script>
		<script th:src="@{/js/bootstrap.js}" type="text/javascript"></script>
		<script th:inline="javascript">
			/*<![CDATA[*/
			$(document).ready(function() {
		
				// 开始功能
				$("#btn_strat").click(function() {
					var taskIds = '';
					$("input[name='checkbox']:checkbox:checked").each(function() {
						taskIds += $(this).val() + ',';
					});
					if (taskIds == '') {
						alert("Error:no one selected.");
					} else {
						// 开始任务
						$.ajax({
							url : "task/startTask",
							type : "POST",
							dataType : "json",
							contentType : "application/json; charset=utf-8",
							data : taskIds,
							success : function(data) {
								alert(data);
							},
							error : function(data) {
								//200的响应也有可能被认定为error，responseText中没有Message部分
								alert($.parseJSON(data.responseText).Message);
							},
							complete : function(data) {
								;//after success or error
							}
						});
					}
				});
		
				// 停止功能
				$("#btn_stop").click(function() {
					var taskIds = '';
					$("input[name='checkbox']:checkbox:checked").each(function() {
						taskIds += $(this).val();
					});
					if (taskIds == '') {
						alert('请选择数据！');
					}
					alert(taskIds);
				});
		
				// 删除功能
				$("#btn_delete").click(function() {
					var taskIds = '';
					$("input[name='checkbox']:checkbox:checked").each(function() {
						taskIds += $(this).val();
					});
					if (taskIds == '') {
						alert('请选择数据！');
					}
					alert(taskIds);
				});
		
			});
			/*]]>*/
		</script>
	
	</head>
	<body>
		<div layout:fragment="left-menu">
			<div>
				<ul class="nav nav-pills nav-stacked">
					<li class="active"><a href="#"><span
							class="glyphicon glyphicon-list"></span> 采集</a></li>
				</ul>
			</div>
			<div class="navbar-header" style="width: 100%;">
				<h4 class="navbar-text">
					<span class="glyphicon glyphicon-folder-open"></span> 采集任务
				</h4>
			</div>
			<!-- 显示任务状态和对应的任务数 -->
			<div style="margin-top: 50px;">
				<ul class="nav nav-pills nav-stacked">
					<li style="padding-left: 30px;" th:each="key : ${taskStatus}">
						<a th:href="@{/task/status/{statusName}(statusName=${key})}">
							<span class="badge pull-right" th:text="${statusAndCount[key]}">2</span>
							<span th:text="${key}"></span>
						</a>
					</li>
				</ul>
			</div>
			<div class="navbar-header" style="width: 100%;">
				<h4 class="navbar-text">
					<span class="glyphicon glyphicon-folder-close "></span> 采集分组
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<a href="/taskgroup/creategroup" class="dropdown-toggle" data-toggle="modal" data-target="#theModal"> 
						<span class="glyphicon glyphicon-plus"></span>
					</a>
				</h4>
			</div>
			<div style="margin-top: 50px;">
				<ul class="nav nav-pills nav-stacked">
					<li th:each="taskGroup:${groups}">
						<a th:href="@{/taskgroup/taskgroups(groupId=${taskGroup.groupId})}">
							<span class="badge pull-left">组</span> &nbsp;&nbsp;<span th:text="${taskGroup.groupName}"></span>
						</a>
					</li>
				</ul>
			</div>
		</div>
		<div  layout:fragment="righttopfirstmenu">
			<div>
				<p class="navbar-text">采集任务</p>
			</div>
			<div>
				<form class="navbar-form navbar-right" role="search" th:action="@{/}" method="get">
					<div class="form-group">
						<select class="form-control input-sm" style="width: 120px;">
							<option value="">全部</option>
							<option th:each="status : ${taskStatus}" th:value="${status}" th:text="${status}"></option>
						</select>
					</div>
					<div class="form-group">
						<input type="text" class="form-control" placeholder="请输入任务名称"/>
					</div>
					<button type="submit" class="btn btn-default">
						<span class="glyphicon glyphicon-search"></span>
					</button>
				</form>
			</div>
		</div>
		<div layout:fragment="righttopsecondmenu">
			<!--向左对齐-->
			<form class="navbar-form navbar-left" role="search">
				<button id="btn_strat" type="button" class="btn btn-default btn-sm">
					<span class="glyphicon glyphicon-play"></span> 开始
				</button>&nbsp; &nbsp;
				<button id="btn_stop" type="button" class="btn btn-default btn-sm">
					<span class="glyphicon glyphicon-stop"></span> 停止
				</button>&nbsp; &nbsp;
				<button id="btn_delete" type="button" class="btn btn-default btn-sm">
					<span class="glyphicon glyphicon-remove"></span> 删除
				</button>
			</form>
			<!--向右对齐-->
			<form class="navbar-form navbar-right" role="search">
				<a th:href="@{/task/createCrawlerTask(groupId=${groupId})}" class="btn btn-success" data-toggle="modal" data-target="#theModal" style="width: 120px;">新建采集</a>
				&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
				&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
			</form>
		</div>
		
		<!-- 显示模态对话框 -->
		<div class="modal fade" id="theModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content"></div>
			</div>
		</div>
	</body>
</html>